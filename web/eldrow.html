 <!DOCTYPE html>
 <!-- SPDX-License-Identifier: GPL-2.0-or-later -->
 <html>
	 <head>
		<meta charset="utf-8"/>
		<style>
			body {
				background-color: #121213;
			}
			#trigger {
				width: 70px;
			}
			#trigger-container {
				width: 70px;
				margin: auto;
			}
			#suggested-container {
				width: 331px;
				margin: auto;
			}
			.candidate, .history, .suggested {
				background-color: #3a3a3c;
				display: inline-block;
			}
			.letter {
				color: white;
				text-transform: uppercase;
				font-family: "Courier New";
				font-weight: bold;
				font-size: 2em;
				display: inline-block;
				width: 40px;
				height: 40px;
				padding-top: 15px;
				padding-bottom: 10px;
				padding-left: 20px;
				border: none;
				caret-color: transparent;
			}
			.empty, .default, .unused {
				background-color: #3a3a3c;
			}
			.used {
				background-color: #b59f3b;
			}
			.located {
				background-color: #538d4e;
			}
		</style>
		<script src="candidates.js"></script>
		<script>
			letters = "abcdefghijklmnopqrstuvwxyz"
			eldrow = [
				new Set(letters),
				new Set(letters),
				new Set(letters),
				new Set(letters),
				new Set(letters)
			]
			used = new Set()

			function transitionSuggestedLetterState(obj) {
				if (obj.className.search('empty') > -1) {
					obj.className = 'suggested letter empty'
				} else if (obj.className.search('default') > -1) {
					obj.className = 'suggested letter used'
				} else if (obj.className.search('used') > -1) {
					obj.className = 'suggested letter located'
				} else if (obj.className.search('located') > -1) {
					obj.className = 'suggested letter unused'
				} else if (obj.className.search('unused') > -1) {
					obj.className = 'suggested letter used'
				}
			}

			function updateState() {
				sc = document.getElementById('suggested-container')
				sls = sc.getElementsByTagName('input')
				seen = new Set()
				for (i = 0; i < sls.length; i++) {
					letter = sls[i].value.replace(/&nbsp;/g, '').toLowerCase()
					classes = sls[i].className
					if (classes.search(/(unused)|(default)/) > -1) {
						if (!seen.has(letter)) {
							for (j = 0; j < sls.length; j++) {
								eldrow[j].delete(letter)
							}
						}
					} else if (classes.search('used') > -1) {
						eldrow[i].delete(letter)
						used.add(letter)
					} else if (classes.search('located') > -1) {
						eldrow[i] = new Set([letter])
					}
					seen.add(letter)
				}
			}

			function genPositionRegex(pos) {
				posregex = "["
				for (const letter of pos) {
					posregex += letter
				}
				posregex += "]"
				return posregex
			}

			function genSelectionRegex() {
				selectregex = "^"
				for (const pos of eldrow) {
					selectregex += genPositionRegex(pos)
				}
				selectregex += "$"
				return new RegExp(selectregex)
			}

			function selectWord() {
				regex = genSelectionRegex()
				selected = candidates.filter(word => regex.test(word))
				if (selected.length) {
					choice = Math.floor(Math.random() * selected.length)
					return selected[choice]
				}
				console.log("Bad state!")
				return "xxxxx"
			}

			function updateSuggested(word) {
				sc = document.getElementById('suggested-container')
				sls = sc.getElementsByTagName('input')
				for (i = 0; i < sls.length; i++) {
					sls[i].value = word[i]
				}
			}

			function resetLetterState() {
				sc = document.getElementById('suggested-container')
				sls = sc.getElementsByTagName('input')
				for (i = 0; i < sls.length; i++) {
					if (sls[i].className.search('located') > -1) {
						continue;
					} else if (used.has(sls[i].value)) {
						sls[i].className = "suggested letter used";
					} else {
						sls[i].className = "suggested letter default";
					}
				}
			}

			function shiftFocus(obj, evt) {
				key = evt.charCode || evt.keyCode
				console.log("Saw: " + key)
				if ((key >= 65) && (key <= 90)) {
					obj.className = "suggested letter default"
					if (obj.nextElementSibling) {
						obj.nextElementSibling.focus()
					}
				} else if (key == 8) {
					obj.className = "suggested letter empty"
					prev = obj.previousElementSibling
					if (prev) {
						prev.focus()
					}
				}
			}

			function trigger() {
				updateState()
				word = selectWord()
				updateSuggested(word)
				resetLetterState()
			}
		</script>
	 </head>
	 <title>Eldrow: Solve a Wordle</title>
	 <body>
		 <br>
		 <div id="suggested-container">
			<input
				onkeyup="shiftFocus(this, event)"
				onclick="transitionSuggestedLetterState(this)"
				maxlength=1
				autocomplete="off"
				autofocus="true"
				class="suggested letter empty">
			<input
				onkeyup="shiftFocus(this, event)"
				onclick="transitionSuggestedLetterState(this)"
				maxlength=1
				autocomplete="off"
				class="suggested letter empty">
			<input
				onkeyup="shiftFocus(this, event)"
				onclick="transitionSuggestedLetterState(this)"
				maxlength=1
				autocomplete="off"
				class="suggested letter empty">
			<input
				onkeyup="shiftFocus(this, event)"
				onclick="transitionSuggestedLetterState(this)"
				maxlength=1
				autocomplete="off"
				class="suggested letter empty">
			<input
				onkeyup="shiftFocus(this, event)"
				onclick="transitionSuggestedLetterState(this)"
				maxlength=1
				autocomplete="off"
				class="suggested letter empty">
		 </div>
		 <br>
		 <div id="trigger-container">
			 <button id="trigger" onclick="trigger()">Generate</button>
		 </div>
	 </body>
 </html>
